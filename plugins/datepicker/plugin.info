{
	"author": "kixam",
	"core-version": ">=5.1.8",
	"description": "datepicker plugin for TiddlyWiki5, based on Pikaday version 1.6.1",
	"list": "readme license usage",
	"plugin-type": "plugin",
	"source": "https://github.com/kixam/TW5-datepicker",
	"title": "$:/plugins/kixam/datepicker",
	"type": "application/json",
	"version": "0.5.2",
    "tiddlers": {
        "$:/plugins/kixam/datepicker/icon": {
            "title": "$:/plugins/kixam/datepicker/icon",
            "tags": "$:/tags/Image",
            "text": "<svg height=\"22pt\" width=\"22pt\" viewBox=\"0 0 128 128\">\n<path d=\"M 13.775391 0 L 2.0664062 6.8671875 L 2.0664062 20.599609 L 13.775391 27.464844 L 25.484375 20.599609 L 25.484375 6.8671875 L 13.775391 0 z M 9.6582031 3.6230469 L 10.292969 3.6230469 C 10.728856 3.6230469 11.101705 3.7794391 11.412109 4.0898438 C 11.722514 4.4002483 11.876953 4.7730982 11.876953 5.2089844 L 11.876953 6.1601562 L 15.681641 6.1601562 L 15.681641 5.2089844 C 15.681641 4.7730982 15.83608 4.4002483 16.146484 4.0898438 C 16.456889 3.7794391 16.829738 3.6230469 17.265625 3.6230469 L 17.900391 3.6230469 C 18.336278 3.6230469 18.709127 3.7794391 19.019531 4.0898438 C 19.329936 4.4002483 19.484375 4.7730982 19.484375 5.2089844 L 19.484375 6.1601562 L 20.753906 6.1601562 C 21.097333 6.1601562 21.393566 6.284192 21.644531 6.5351562 C 21.895499 6.7861224 22.021484 7.0843085 22.021484 7.4277344 L 22.021484 20.107422 C 22.021484 20.450848 21.895499 20.749034 21.644531 21 C 21.393566 21.250966 21.097333 21.375 20.753906 21.375 L 6.8046875 21.375 C 6.4612605 21.375 6.1650274 21.250966 5.9140625 21 C 5.6630976 20.749034 5.5371094 20.450848 5.5371094 20.107422 L 5.5371094 7.4277344 C 5.5371094 7.0843085 5.6630976 6.7861224 5.9140625 6.5351562 C 6.1650274 6.284192 6.4612605 6.1601563 6.8046875 6.1601562 L 8.0722656 6.1601562 L 8.0722656 5.2089844 C 8.0722656 4.7730982 8.2286584 4.4002483 8.5390625 4.0898438 C 8.8494667 3.7794391 9.2223157 3.6230469 9.6582031 3.6230469 z M 9.6582031 4.890625 C 9.5723471 4.890625 9.4982891 4.923586 9.4355469 4.9863281 C 9.3728059 5.0490687 9.3417969 5.1231279 9.3417969 5.2089844 L 9.3417969 8.0605469 C 9.3417969 8.1464033 9.3728059 8.222414 9.4355469 8.2851562 C 9.4982891 8.3478969 9.5723471 8.3789062 9.6582031 8.3789062 L 10.292969 8.3789062 C 10.378825 8.3789062 10.452884 8.3478969 10.515625 8.2851562 C 10.578367 8.222414 10.609375 8.1464033 10.609375 8.0605469 L 10.609375 5.2089844 C 10.609375 5.1231279 10.578367 5.0490687 10.515625 4.9863281 C 10.452884 4.923586 10.378825 4.890625 10.292969 4.890625 L 9.6582031 4.890625 z M 17.265625 4.890625 C 17.179769 4.890625 17.105711 4.923586 17.042969 4.9863281 C 16.980227 5.0490687 16.949219 5.1231279 16.949219 5.2089844 L 16.949219 8.0605469 C 16.949219 8.1464033 16.980227 8.222414 17.042969 8.2851562 C 17.105711 8.3478969 17.179769 8.3789062 17.265625 8.3789062 L 17.900391 8.3789062 C 17.986247 8.3789062 18.060305 8.3478969 18.123047 8.2851562 C 18.185788 8.222414 18.216797 8.1464033 18.216797 8.0605469 L 18.216797 5.2089844 C 18.216797 5.1231279 18.185788 5.0490687 18.123047 4.9863281 C 18.060305 4.923586 17.986247 4.890625 17.900391 4.890625 L 17.265625 4.890625 z M 6.8046875 9.9628906 L 6.8046875 12.816406 L 9.6582031 12.816406 L 9.6582031 9.9628906 L 6.8046875 9.9628906 z M 10.292969 9.9628906 L 10.292969 12.816406 L 13.462891 12.816406 L 13.462891 9.9628906 L 10.292969 9.9628906 z M 14.095703 9.9628906 L 14.095703 12.816406 L 17.265625 12.816406 L 17.265625 9.9628906 L 14.095703 9.9628906 z M 17.900391 9.9628906 L 17.900391 12.816406 L 20.753906 12.816406 L 20.753906 9.9628906 L 17.900391 9.9628906 z M 6.8046875 13.451172 L 6.8046875 16.621094 L 9.6582031 16.621094 L 9.6582031 13.451172 L 6.8046875 13.451172 z M 10.292969 13.451172 L 10.292969 16.621094 L 13.462891 16.621094 L 13.462891 13.451172 L 10.292969 13.451172 z M 14.095703 13.451172 L 14.095703 16.621094 L 17.265625 16.621094 L 17.265625 13.451172 L 14.095703 13.451172 z M 17.900391 13.451172 L 17.900391 16.621094 L 20.753906 16.621094 L 20.753906 13.451172 L 17.900391 13.451172 z M 6.8046875 17.253906 L 6.8046875 20.107422 L 9.6582031 20.107422 L 9.6582031 17.253906 L 6.8046875 17.253906 z M 10.292969 17.253906 L 10.292969 20.107422 L 13.462891 20.107422 L 13.462891 17.253906 L 10.292969 17.253906 z M 14.095703 17.253906 L 14.095703 20.107422 L 17.265625 20.107422 L 17.265625 17.253906 L 14.095703 17.253906 z M 17.900391 17.253906 L 17.900391 20.107422 L 20.753906 20.107422 L 20.753906 17.253906 L 17.900391 17.253906 z\" transform=\"scale(4.6545455,4.6545455)\" />\n</svg>\n"
        },
        "$:/plugins/kixam/datepicker/pikaday.js": {
            "title": "$:/plugins/kixam/datepicker/pikaday.js",
            "text": "/*\\\ntitle: $:/plugins/kixam/datepicker/pikaday.js\ntype: application/javascript\nmodule-type: library\n\n@preserve\n\\*/\n\n(function(root,factory){\"use strict\";var moment;if(typeof exports===\"object\"){try{moment=require(\"$:/plugins/kixam/moment/moment.js\")}catch(e){}module.exports=factory(moment)}else if(typeof define===\"function\"&&define.amd){define(function(req){var id=\"moment\";try{moment=req(id)}catch(e){}return factory(moment)})}else{root.Pikaday=factory(root.moment)}})(this,function(moment){\"use strict\";var hasMoment=typeof moment===\"function\",addEvent=function(el,e,callback,capture){if(!!window.addEventListener){el.addEventListener(e,callback,!!capture)}else{el.attachEvent(\"on\"+e,callback)}},removeEvent=function(el,e,callback,capture){if(!!window.addEventListener){el.removeEventListener(e,callback,!!capture)}else{el.detachEvent(\"on\"+e,callback)}},trim=function(str){return str.trim?str.trim():str.replace(/^\\s+|\\s+$/g,\"\")},hasClass=function(el,cn){return(\" \"+el.className+\" \").indexOf(\" \"+cn+\" \")!==-1},addClass=function(el,cn){if(!hasClass(el,cn)){el.className=el.className===\"\"?cn:el.className+\" \"+cn}},removeClass=function(el,cn){el.className=trim((\" \"+el.className+\" \").replace(\" \"+cn+\" \",\" \"))},isArray=function(obj){return/Array/.test(Object.prototype.toString.call(obj))},isDate=function(obj){return/Date/.test(Object.prototype.toString.call(obj))&&!isNaN(obj.getTime())},isWeekend=function(date){var day=date.getDay();return day===0||day===6},isLeapYear=function(year){return year%4===0&&year%100!==0||year%400===0},getDaysInMonth=function(year,month){return[31,isLeapYear(year)?29:28,31,30,31,30,31,31,30,31,30,31][month]},setToStartOfDay=function(date){if(isDate(date))date.setHours(0,0,0,0)},compareDates=function(a,b){var _a=new Date(a.getTime());var _b=new Date(b.getTime());setToStartOfDay(_a);setToStartOfDay(_b);return _a.getTime()===_b.getTime()},extend=function(to,from,overwrite){var prop,hasProp;for(prop in from){hasProp=to[prop]!==undefined;if(hasProp&&typeof from[prop]===\"object\"&&from[prop]!==null&&from[prop].nodeName===undefined){if(isDate(from[prop])){if(overwrite){to[prop]=new Date(from[prop].getTime())}}else if(isArray(from[prop])){if(overwrite){to[prop]=from[prop].slice(0)}}else{to[prop]=extend({},from[prop],overwrite)}}else if(overwrite||!hasProp){to[prop]=from[prop]}}return to},fireEvent=function(el,eventName,data){var ev;if(document.createEvent){ev=window.document.createEvent(\"HTMLEvents\");ev.initEvent(eventName,true,false);ev=extend(ev,data);el.dispatchEvent(ev)}else if(document.createEventObject){ev=window.document.createEventObject();ev=extend(ev,data);el.fireEvent(\"on\"+eventName,ev)}},adjustCalendar=function(calendar){if(calendar.month<0){calendar.year-=Math.ceil(Math.abs(calendar.month)/12);calendar.month+=12}if(calendar.month>11){calendar.year+=Math.floor(Math.abs(calendar.month)/12);calendar.month-=12}return calendar},defaults={field:null,bound:undefined,ariaLabel:\"Use the arrow keys to pick a date\",position:\"bottom left\",reposition:true,format:null,inputFormats:null,toString:null,parse:null,defaultDate:null,setDefaultDate:false,firstDay:0,formatStrict:false,minDate:null,maxDate:null,yearRange:10,showWeekNumber:false,pickWholeWeek:false,minYear:0,maxYear:9999,minMonth:undefined,maxMonth:undefined,startRange:null,endRange:null,isRTL:false,yearSuffix:\"\",showMonthAfterYear:false,showDaysInNextAndPreviousMonths:false,enableSelectionDaysInNextAndPreviousMonths:false,numberOfMonths:1,showTime:true,showMinutes:true,showSeconds:false,use24hour:false,incrementHourBy:1,incrementMinuteBy:1,incrementSecondBy:1,timeLabel:null,autoClose:true,mainCalendar:\"left\",container:undefined,blurFieldOnSelect:true,i18n:{previousMonth:\"Previous Month\",nextMonth:\"Next Month\",months:[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],weekdays:[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"],weekdaysShort:[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],midnight:\"Midnight\",noon:\"Noon\"},theme:null,events:[],onSelect:null,onOpen:null,onClose:null,onDraw:null,keyboardInput:true},renderDayName=function(opts,day,abbr){day+=opts.firstDay;while(day>=7){day-=7}return abbr?opts.i18n.weekdaysShort[day]:opts.i18n.weekdays[day]},renderDay=function(opts){var arr=[];var ariaSelected=\"false\";if(opts.isEmpty){if(opts.showDaysInNextAndPreviousMonths){arr.push(\"is-outside-current-month\");if(!opts.enableSelectionDaysInNextAndPreviousMonths){arr.push(\"is-selection-disabled\")}}else{return'<td class=\"is-empty\"></td>'}}if(opts.isDisabled){arr.push(\"is-disabled\")}if(opts.isToday){arr.push(\"is-today\")}if(opts.isSelected){arr.push(\"is-selected\");ariaSelected=\"true\"}if(opts.hasEvent){arr.push(\"has-event\")}if(opts.isInRange){arr.push(\"is-inrange\")}if(opts.isStartRange){arr.push(\"is-startrange\")}if(opts.isEndRange){arr.push(\"is-endrange\")}return'<td data-day=\"'+opts.day+'\" class=\"'+arr.join(\" \")+'\" aria-selected=\"'+ariaSelected+'\">'+'<button class=\"pika-button pika-day\" type=\"button\" '+'data-pika-year=\"'+opts.year+'\" data-pika-month=\"'+opts.month+'\" data-pika-day=\"'+opts.day+'\">'+opts.day+\"</button>\"+\"</td>\"},renderWeek=function(d,m,y){var onejan=new Date(y,0,1),weekNum=Math.ceil(((new Date(y,m,d)-onejan)/864e5+onejan.getDay()+1)/7);return'<td class=\"pika-week\">'+weekNum+\"</td>\"},renderRow=function(days,isRTL,pickWholeWeek,isRowSelected){return'<tr class=\"pika-row'+(pickWholeWeek?\" pick-whole-week\":\"\")+(isRowSelected?\" is-selected\":\"\")+'\">'+(isRTL?days.reverse():days).join(\"\")+\"</tr>\"},renderBody=function(rows){return\"<tbody>\"+rows.join(\"\")+\"</tbody>\"},renderHead=function(opts){var i,arr=[];if(opts.showWeekNumber){arr.push(\"<th></th>\")}for(i=0;i<7;i++){arr.push('<th scope=\"col\"><abbr title=\"'+renderDayName(opts,i)+'\">'+renderDayName(opts,i,true)+\"</abbr></th>\")}return\"<thead><tr>\"+(opts.isRTL?arr.reverse():arr).join(\"\")+\"</tr></thead>\"},renderTitle=function(instance,c,year,month,refYear,randId){var i,j,arr,opts=instance._o,isMinYear=year===opts.minYear,isMaxYear=year===opts.maxYear,html='<div id=\"'+randId+'\" class=\"pika-title\" role=\"heading\" aria-live=\"assertive\">',monthHtml,yearHtml,prev=true,next=true;for(arr=[],i=0;i<12;i++){arr.push('<option value=\"'+(year===refYear?i-c:12+i-c)+'\"'+(i===month?' selected=\"selected\"':\"\")+(isMinYear&&i<opts.minMonth||isMaxYear&&i>opts.maxMonth?'disabled=\"disabled\"':\"\")+\">\"+opts.i18n.months[i]+\"</option>\")}monthHtml='<div class=\"pika-label\">'+opts.i18n.months[month]+'<select class=\"pika-select pika-select-month\" tabindex=\"-1\">'+arr.join(\"\")+\"</select></div>\";if(isArray(opts.yearRange)){i=opts.yearRange[0];j=opts.yearRange[1]+1}else{i=year-opts.yearRange;j=1+year+opts.yearRange}for(arr=[];i<j&&i<=opts.maxYear;i++){if(i>=opts.minYear){arr.push('<option value=\"'+i+'\"'+(i===year?' selected=\"selected\"':\"\")+\">\"+i+\"</option>\")}}yearHtml='<div class=\"pika-label\">'+year+opts.yearSuffix+'<select class=\"pika-select pika-select-year\" tabindex=\"-1\">'+arr.join(\"\")+\"</select></div>\";if(opts.showMonthAfterYear){html+=yearHtml+monthHtml}else{html+=monthHtml+yearHtml}if(isMinYear&&(month===0||opts.minMonth>=month)){prev=false}if(isMaxYear&&(month===11||opts.maxMonth<=month)){next=false}if(c===0){html+='<button class=\"pika-prev'+(prev?\"\":\" is-disabled\")+'\" type=\"button\">'+opts.i18n.previousMonth+\"</button>\"}if(c===instance._o.numberOfMonths-1){html+='<button class=\"pika-next'+(next?\"\":\" is-disabled\")+'\" type=\"button\">'+opts.i18n.nextMonth+\"</button>\"}return html+=\"</div>\"},renderTable=function(opts,data,randId){return'<table cellpadding=\"0\" cellspacing=\"0\" class=\"pika-table\" role=\"grid\" aria-labelledby=\"'+randId+'\">'+renderHead(opts)+renderBody(data)+\"</table>\"},renderTimePicker=function(num_options,selected_val,select_class,display_func,increment_by){increment_by=increment_by||1;var to_return='<td><select class=\"pika-select '+select_class+'\">';for(var i=0;i<num_options;i+=increment_by){to_return+='<option value=\"'+i+'\" '+(i==selected_val?\"selected\":\"\")+\">\"+display_func(i)+\"</option>\"}to_return+=\"</select></td>\";return to_return},renderTime=function(hh,mm,ss,opts){var to_return='<table cellpadding=\"0\" cellspacing=\"0\" class=\"pika-time\"><tbody><tr>'+(opts.timeLabel!==null?'<td class=\"pika-time-label\">'+opts.timeLabel+\"</td>\":\"\")+renderTimePicker(24,hh,\"pika-select-hour\",function(i){if(opts.use24hour){return i}else{var to_return=i%12+(i<12?\" AM\":\" PM\");if(to_return==\"0 AM\"){return opts.i18n.midnight}else if(to_return==\"0 PM\"){return opts.i18n.noon}else{return to_return}}},opts.incrementHourBy);if(opts.showMinutes){to_return+=\"<td>:</td>\"+renderTimePicker(60,mm,\"pika-select-minute\",function(i){if(i<10)return\"0\"+i;return i},opts.incrementMinuteBy)}if(opts.showSeconds){to_return+=\"<td>:</td>\"+renderTimePicker(60,ss,\"pika-select-second\",function(i){if(i<10)return\"0\"+i;return i},opts.incrementSecondBy)}return to_return+\"</tr></tbody></table>\"},Pikaday=function(options){var self=this,opts=self.config(options);self._onMouseDown=function(e){if(!self._v){return}e=e||window.event;var target=e.target||e.srcElement;if(!target){return}if(!hasClass(target,\"is-disabled\")){if(hasClass(target,\"pika-button\")&&!hasClass(target,\"is-empty\")&&!hasClass(target.parentNode,\"is-disabled\")){var newDate=new Date(target.getAttribute(\"data-pika-year\"),target.getAttribute(\"data-pika-month\"),target.getAttribute(\"data-pika-day\"));var prevDate=self._d||opts.defaultDate;if(prevDate&&isDate(prevDate)&&opts.showTime){newDate.setHours(prevDate.getHours());newDate.setMinutes(prevDate.getMinutes());if(opts.showSeconds){newDate.setSeconds(prevDate.getSeconds())}}self.setDate(newDate);if(opts.bound){window.setTimeout(function(){if(opts.autoClose){self.hide()}if(opts.blurFieldOnSelect&&opts.field){opts.field.blur()}},100)}}else if(hasClass(target,\"pika-prev\")){self.prevMonth()}else if(hasClass(target,\"pika-next\")){self.nextMonth()}}if(!hasClass(target,\"pika-select\")){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false;return false}}else{self._c=true}};self._onChange=function(e){e=e||window.event;var target=e.target||e.srcElement;if(!target){return}if(hasClass(target,\"pika-select-month\")){self.gotoMonth(target.value)}else if(hasClass(target,\"pika-select-year\")){self.gotoYear(target.value)}else if(hasClass(target,\"pika-select-hour\")){self.setTime(target.value)}else if(hasClass(target,\"pika-select-minute\")){self.setTime(null,target.value)}else if(hasClass(target,\"pika-select-second\")){self.setTime(null,null,target.value)}};self._onKeyChange=function(e){e=e||window.event;if(self.isVisible()){switch(e.keyCode){case 13:case 27:if(opts.field){opts.field.blur()}break;case 37:e.preventDefault();self.adjustDate(\"subtract\",1);break;case 38:self.adjustDate(\"subtract\",7);break;case 39:self.adjustDate(\"add\",1);break;case 40:self.adjustDate(\"add\",7);break}}};self._onInputChange=function(e){var date;if(e.firedBy===self){return}if(opts.parse){date=opts.parse(opts.field.value,opts.format||opts.inputFormats)}else if(hasMoment){date=moment(opts.field.value,opts.inputFormats,opts.formatStrict);date=date&&date.isValid()?date.toDate():null}else{date=new Date(Date.parse(opts.field.value))}if(isDate(date)){self.setDate(date)}if(!self._v){self.show()}};self._onInputFocus=function(){self.show()};self._onInputClick=function(){self.show()};self._onInputBlur=function(){var pEl=window.document.activeElement;do{if(hasClass(pEl,\"pika-single\")){return}}while(pEl=pEl.parentNode);if(opts.autoClose&&!self._c){self._b=window.setTimeout(function(){self.hide()},50)}self._c=false};self._onClick=function(e){e=e||window.event;var target=e.target||e.srcElement,pEl=target;if(!target){return}if(!!!window.addEventListener&&hasClass(target,\"pika-select\")){if(!target.onchange){target.setAttribute(\"onchange\",\"return;\");addEvent(target,\"change\",self._onChange)}}do{if(hasClass(pEl,\"pika-single\")||pEl===opts.trigger||opts.showTime&&hasClass(pEl,\"pika-time-container\")){return}}while(pEl=pEl.parentNode);if(self._v&&target!==opts.trigger&&pEl!==opts.trigger){self.hide()}};self.el=window.document.createElement(\"div\");self.el.className=\"pika-single\"+(opts.isRTL?\" is-rtl\":\"\")+(opts.theme?\" \"+opts.theme:\"\");addEvent(self.el,\"mousedown\",self._onMouseDown,true);addEvent(self.el,\"touchend\",self._onMouseDown,true);addEvent(self.el,\"change\",self._onChange);if(opts.keyboardInput){addEvent(document,\"keydown\",self._onKeyChange)}if(opts.field){if(opts.container){opts.container.appendChild(self.el)}else if(opts.bound){window.document.body.appendChild(self.el)}else{opts.field.parentNode.insertBefore(self.el,opts.field.nextSibling)}addEvent(opts.field,\"change\",self._onInputChange);if(!opts.defaultDate){if(hasMoment&&opts.field.value){opts.defaultDate=moment(opts.field.value,opts.inputFormats).toDate()}else{opts.defaultDate=new Date(Date.parse(opts.field.value))}opts.setDefaultDate=true}}var defDate=opts.defaultDate;if(isDate(defDate)){if(opts.setDefaultDate){self.setDate(defDate,true)}else{self.gotoDate(defDate)}}else{self.gotoDate(new Date)}if(opts.bound){this.hide();self.el.className+=\" is-bound\";addEvent(opts.trigger,\"click\",self._onInputClick);addEvent(opts.trigger,\"focus\",self._onInputFocus);addEvent(opts.trigger,\"blur\",self._onInputBlur)}else{this.show()}};Pikaday.prototype={config:function(options){if(!this._o){this._o=extend({},defaults,true)}var opts=extend(this._o,options,true);opts.isRTL=!!opts.isRTL;opts.autoClose=!!opts.autoClose;opts.field=opts.field&&opts.field.nodeName?opts.field:null;opts.theme=typeof opts.theme===\"string\"&&opts.theme?opts.theme:null;opts.bound=!!(opts.bound!==undefined?opts.field&&opts.bound:opts.field);opts.trigger=opts.trigger&&opts.trigger.nodeName?opts.trigger:opts.field;opts.disableWeekends=!!opts.disableWeekends;opts.disableDayFn=typeof opts.disableDayFn===\"function\"?opts.disableDayFn:null;var nom=parseInt(opts.numberOfMonths,10)||1;opts.numberOfMonths=nom>4?4:nom;if(!isDate(opts.minDate)){opts.minDate=false}if(!isDate(opts.maxDate)){opts.maxDate=false}if(opts.minDate&&opts.maxDate&&opts.maxDate<opts.minDate){opts.maxDate=opts.minDate=false}if(opts.minDate){this.setMinDate(opts.minDate)}if(opts.maxDate){this.setMaxDate(opts.maxDate)}if(isArray(opts.yearRange)){var fallback=(new Date).getFullYear()-10;opts.yearRange[0]=parseInt(opts.yearRange[0],10)||fallback;opts.yearRange[1]=parseInt(opts.yearRange[1],10)||fallback}else{opts.yearRange=Math.abs(parseInt(opts.yearRange,10))||defaults.yearRange;if(opts.yearRange>100){opts.yearRange=100}}if(opts.format===null){opts.format=\"YYYY-MM-DD\";if(opts.showTime){opts.format+=\" HH:mm:ss\"}}if(!opts.inputFormats){opts.inputFormats=opts.format}return opts},toString:function(format){format=format||this._o.format;if(!isDate(this._d)){return\"\"}if(this._o.toString){return this._o.toString(this._d,format)}if(hasMoment){return moment(this._d).format(format)}if(this._o.showTime){return this._d.toString()}return this._d.toDateString()},getMoment:function(){return hasMoment?moment(this._d):null},setMoment:function(date,preventOnSelect){if(hasMoment&&moment.isMoment(date)){this.setDate(date.toDate(),preventOnSelect)}},getDate:function(){return isDate(this._d)?new Date(this._d.getTime()):null},setTime:function(hours,minutes,seconds){if(!this._d){this._d=new Date;this._d.setHours(0,0,0,0)}if(hours){this._d.setHours(hours)}if(minutes){this._d.setMinutes(minutes)}if(seconds){this._d.setSeconds(seconds)}this.setDate(this._d)},setDate:function(date,preventOnSelect){if(!date){this._d=null;if(this._o.field){this._o.field.value=\"\";fireEvent(this._o.field,\"change\",{firedBy:this})}return this.draw()}if(typeof date===\"string\"){date=new Date(Date.parse(date))}if(!isDate(date)){return}var min=this._o.minDate,max=this._o.maxDate;if(isDate(min)&&date<min){date=min}else if(isDate(max)&&date>max){date=max}this._d=new Date(date.getTime());if(this._o.showTime&&!this._o.showSeconds){this._d.setSeconds(0)}else if(!this._o.showTime){setToStartOfDay(this._d)}this.gotoDate(this._d);if(this._o.field){this._o.field.value=this.toString();fireEvent(this._o.field,\"change\",{firedBy:this})}if(!preventOnSelect&&typeof this._o.onSelect===\"function\"){this._o.onSelect.call(this,this.getDate())}},gotoDate:function(date){var newCalendar=true;if(!isDate(date)){return}if(this.calendars){var firstVisibleDate=new Date(this.calendars[0].year,this.calendars[0].month,1),lastVisibleDate=new Date(this.calendars[this.calendars.length-1].year,this.calendars[this.calendars.length-1].month,1),visibleDate=date.getTime();lastVisibleDate.setMonth(lastVisibleDate.getMonth()+1);lastVisibleDate.setDate(lastVisibleDate.getDate()-1);newCalendar=visibleDate<firstVisibleDate.getTime()||lastVisibleDate.getTime()<visibleDate}if(newCalendar){this.calendars=[{month:date.getMonth(),year:date.getFullYear(),hour:date.getHours(),minute:date.getMinutes(),second:date.getSeconds()}];if(this._o.mainCalendar===\"right\"){this.calendars[0].month+=1-this._o.numberOfMonths}}this.adjustCalendars()},adjustDate:function(sign,days){var day=this.getDate()||new Date;var difference=parseInt(days)*24*60*60*1e3;var newDay;if(sign===\"add\"){newDay=new Date(day.valueOf()+difference)}else if(sign===\"subtract\"){newDay=new Date(day.valueOf()-difference)}this.setDate(newDay)},adjustCalendars:function(){this.calendars[0]=adjustCalendar(this.calendars[0]);for(var c=1;c<this._o.numberOfMonths;c++){this.calendars[c]=adjustCalendar({month:this.calendars[0].month+c,year:this.calendars[0].year})}this.draw()},gotoToday:function(){this.gotoDate(new Date)},gotoMonth:function(month){if(!isNaN(month)){this.calendars[0].month=parseInt(month,10);this.adjustCalendars()}},nextMonth:function(){this.calendars[0].month++;this.adjustCalendars()},prevMonth:function(){this.calendars[0].month--;this.adjustCalendars()},gotoYear:function(year){if(!isNaN(year)){this.calendars[0].year=parseInt(year,10);this.adjustCalendars()}},setMinDate:function(value){if(value instanceof Date){if(!this._o.showTime)setToStartOfDay(value);this._o.minDate=value;this._o.minYear=value.getFullYear();this._o.minMonth=value.getMonth()}else{this._o.minDate=defaults.minDate;this._o.minYear=defaults.minYear;this._o.minMonth=defaults.minMonth;this._o.startRange=defaults.startRange}this.draw()},setMaxDate:function(value){if(value instanceof Date){if(!this._o.showTime)setToStartOfDay(value);this._o.maxDate=value;this._o.maxYear=value.getFullYear();this._o.maxMonth=value.getMonth()}else{this._o.maxDate=defaults.maxDate;this._o.maxYear=defaults.maxYear;this._o.maxMonth=defaults.maxMonth;this._o.endRange=defaults.endRange}this.draw()},setStartRange:function(value){this._o.startRange=value},setEndRange:function(value){this._o.endRange=value},draw:function(force){if(!this._v&&!force){return}var opts=this._o,minYear=opts.minYear,maxYear=opts.maxYear,minMonth=opts.minMonth,maxMonth=opts.maxMonth,html=\"\",randId;if(this._y<=minYear){this._y=minYear;if(!isNaN(minMonth)&&this._m<minMonth){this._m=minMonth}}if(this._y>=maxYear){this._y=maxYear;if(!isNaN(maxMonth)&&this._m>maxMonth){this._m=maxMonth}}randId=\"pika-title-\"+Math.random().toString(36).replace(/[^a-z]+/g,\"\").substr(0,2);for(var c=0;c<opts.numberOfMonths;c++){html+='<div class=\"pika-lendar\">'+renderTitle(this,c,this.calendars[c].year,this.calendars[c].month,this.calendars[0].year,randId)+this.render(this.calendars[c].year,this.calendars[c].month,randId)+\"</div>\"}if(opts.showTime){var prevDate=this._d||this._o.defaultDate;html+='<div class=\"pika-time-container\">'+renderTime(prevDate&&isDate(prevDate)?prevDate.getHours():0,prevDate&&isDate(prevDate)?prevDate.getMinutes():0,prevDate&&isDate(prevDate)?prevDate.getSeconds():0,opts)+\"</div>\"}this.el.innerHTML=html;if(opts.bound){if(opts.field.type!==\"hidden\"){window.setTimeout(function(){opts.trigger.focus()},1)}}if(typeof this._o.onDraw===\"function\"){this._o.onDraw(this)}if(opts.bound){opts.field.setAttribute(\"aria-label\",opts.ariaLabel)}},adjustPosition:function(){var field,pEl,width,height,viewportWidth,viewportHeight,scrollTop,left,top,clientRect;if(this._o.container)return;this.el.style.position=\"absolute\";field=this._o.trigger;pEl=field;width=this.el.offsetWidth;height=this.el.offsetHeight;viewportWidth=window.innerWidth||window.document.documentElement.clientWidth;viewportHeight=window.innerHeight||window.document.documentElement.clientHeight;scrollTop=window.pageYOffset||document.body.scrollTop||window.document.documentElement.scrollTop;if(typeof field.getBoundingClientRect===\"function\"){clientRect=field.getBoundingClientRect();left=clientRect.left+window.pageXOffset;top=clientRect.bottom+window.pageYOffset}else{left=pEl.offsetLeft;top=pEl.offsetTop+pEl.offsetHeight;while(pEl=pEl.offsetParent){left+=pEl.offsetLeft;top+=pEl.offsetTop}}if(this._o.reposition&&left+width>viewportWidth||this._o.position.indexOf(\"right\")>-1&&left-width+field.offsetWidth>0){left=left-width+field.offsetWidth}if(this._o.reposition&&top+height>viewportHeight+scrollTop||this._o.position.indexOf(\"top\")>-1&&top-height-field.offsetHeight>0){top=top-height-field.offsetHeight}this.el.style.left=left+\"px\";this.el.style.top=top+\"px\"},render:function(year,month,randId){var opts=this._o,now=new Date,days=getDaysInMonth(year,month),before=new Date(year,month,1).getDay(),data=[],row=[];if(!opts.showTime)setToStartOfDay(now);if(opts.firstDay>0){before-=opts.firstDay;if(before<0){before+=7}}var previousMonth=month===0?11:month-1,nextMonth=month===11?0:month+1,yearOfPreviousMonth=month===0?year-1:year,yearOfNextMonth=month===11?year+1:year,daysInPreviousMonth=getDaysInMonth(yearOfPreviousMonth,previousMonth);var cells=days+before,after=cells;while(after>7){after-=7}cells+=7-after;var minDate_date=opts.minDate?new Date(opts.minDate.getFullYear(),opts.minDate.getMonth(),opts.minDate.getDate()):null;var maxDate_date=opts.maxDate?new Date(opts.maxDate.getFullYear(),opts.maxDate.getMonth(),opts.maxDate.getDate()):null;var isWeekSelected=false;for(var i=0,r=0;i<cells;i++){var day=new Date(year,month,1+(i-before)),isSelected=isDate(this._d)?compareDates(day,this._d):false,isToday=compareDates(day,now),hasEvent=opts.events.indexOf(day.toDateString())!==-1?true:false,isEmpty=i<before||i>=days+before,dayNumber=1+(i-before),monthNumber=month,yearNumber=year,isStartRange=opts.startRange&&compareDates(opts.startRange,day),isEndRange=opts.endRange&&compareDates(opts.endRange,day),isInRange=opts.startRange&&opts.endRange&&opts.startRange<day&&day<opts.endRange,isDisabled=minDate_date&&day<minDate_date||maxDate_date&&day>maxDate_date||opts.disableWeekends&&isWeekend(day)||opts.disableDayFn&&opts.disableDayFn(day);if(isEmpty){if(i<before){dayNumber=daysInPreviousMonth+dayNumber;monthNumber=previousMonth;yearNumber=yearOfPreviousMonth}else{dayNumber=dayNumber-days;monthNumber=nextMonth;yearNumber=yearOfNextMonth}}var dayConfig={day:dayNumber,month:monthNumber,year:yearNumber,hasEvent:hasEvent,isSelected:isSelected,isToday:isToday,isDisabled:isDisabled,isEmpty:isEmpty,isStartRange:isStartRange,isEndRange:isEndRange,isInRange:isInRange,showDaysInNextAndPreviousMonths:opts.showDaysInNextAndPreviousMonths,enableSelectionDaysInNextAndPreviousMonths:opts.enableSelectionDaysInNextAndPreviousMonths};if(opts.pickWholeWeek&&isSelected){isWeekSelected=true}row.push(renderDay(dayConfig));if(++r===7){if(opts.showWeekNumber){row.unshift(renderWeek(i-before,month,year))}data.push(renderRow(row,opts.isRTL,opts.pickWholeWeek,isWeekSelected));row=[];r=0;isWeekSelected=false}}return renderTable(opts,data,randId)},isVisible:function(){return this._v},show:function(){if(!this.isVisible()){this._v=true;this.draw();removeClass(this.el,\"is-hidden\");if(this._o.bound){addEvent(document,\"click\",this._onClick);this.adjustPosition()}if(typeof this._o.onOpen===\"function\"){this._o.onOpen.call(this)}}},hide:function(){var v=this._v;if(v!==false){if(this._o.bound){removeEvent(document,\"click\",this._onClick)}this.el.style.position=\"static\";this.el.style.left=\"auto\";this.el.style.top=\"auto\";addClass(this.el,\"is-hidden\");this._v=false;if(v!==undefined&&typeof this._o.onClose===\"function\"){this._o.onClose.call(this)}}},destroy:function(){var opts=this._o;this.hide();removeEvent(this.el,\"mousedown\",this._onMouseDown,true);removeEvent(this.el,\"touchend\",this._onMouseDown,true);removeEvent(this.el,\"change\",this._onChange);if(opts.keyboardInput){removeEvent(document,\"keydown\",this._onKeyChange)}if(opts.field){removeEvent(opts.field,\"change\",this._onInputChange);if(opts.bound){removeEvent(opts.trigger,\"click\",this._onInputClick);removeEvent(opts.trigger,\"focus\",this._onInputFocus);removeEvent(opts.trigger,\"blur\",this._onInputBlur)}}if(this.el.parentNode){this.el.parentNode.removeChild(this.el)}}};return Pikaday});\n",
            "type": "application/javascript",
            "module-type": "library"
        },
        "$:/plugins/kixam/datepicker/license": {
            "title": "$:/plugins/kixam/datepicker/license",
            "text": "!! Pikaday licence: [[BSD 2-clause simplified license|http://www.freebsd.org/copyright/freebsd-license.html]] and [[MIT|http://mit-license.org/]]\n```\nCopyright (c) 2014 David Bushell BSD & MIT license\n\nThe MIT License (MIT)\n\nCopyright (c) 2014 David Bushell\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\nTHE SOFTWARE.\n\nThe BSD License\n\nCopyright (c) 2014 David Bushell\nAll rights reserved.\n\nRedistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:\n\n1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.\n\n2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n```\n\n!! Plugin license: [[BSD 2-clause simplified license|http://www.freebsd.org/copyright/freebsd-license.html]]\n```\nCopyright (c) 2015, kixam\nAll rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are met:\n\n1. Redistributions of source code must retain the above copyright notice, this\n  list of conditions and the following disclaimer.\n\n2. Redistributions in binary form must reproduce the above copyright notice,\n  this list of conditions and the following disclaimer in the documentation\n  and/or other materials provided with the distribution.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\nAND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\nIMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\nDISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\nFOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\nDAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\nSERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\nCAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\nOR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\nOF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n```\n"
        },
        "$:/plugins/kixam/datepicker/pikaday.css": {
            "title": "$:/plugins/kixam/datepicker/pikaday.css",
            "type": "text/css",
            "tags": "$:/tags/Stylesheet",
            "text": "@charset \"UTF-8\";/*!\n * Pikaday\n * Copyright Â© 2014 David Bushell | BSD & MIT license | http://dbushell.com/\n */.pika-single{z-index:9999;display:block;position:relative;color:#333;background:#fff;border:1px solid #ccc;border-bottom-color:#bbb;font-family:\"Helvetica Neue\",Helvetica,Arial,sans-serif}.pika-single:before,.pika-single:after{content:\" \";display:table}.pika-single:after{clear:both}.pika-single{*zoom:1}.pika-single.is-hidden{display:none}.pika-single.is-bound{position:absolute;box-shadow:0 5px 15px -5px rgba(0,0,0,.5)}.pika-lendar{float:left;width:240px;margin:8px}.pika-title{position:relative;text-align:center}.pika-label{display:inline-block;*display:inline;position:relative;z-index:9999;overflow:hidden;margin:0;padding:5px 3px;font-size:14px;line-height:20px;font-weight:bold;background-color:#fff}.pika-title select{cursor:pointer;position:absolute;z-index:9998;margin:0;left:0;top:5px;filter:alpha(opacity=0);opacity:0}.pika-prev,.pika-next{display:block;cursor:pointer;position:relative;outline:0;border:0;padding:0;width:20px;height:30px;color:rgba(0,0,0,0);white-space:nowrap;overflow:hidden;background-color:transparent;background-position:center center;background-repeat:no-repeat;background-size:75% 75%;opacity:.5;*position:absolute;*top:0}.pika-prev:hover,.pika-next:hover{opacity:1}.pika-prev,.is-rtl .pika-next{float:left;background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAAUklEQVR42u3VMQoAIBADQf8Pgj+OD9hG2CtONJB2ymQkKe0HbwAP0xucDiQWARITIDEBEnMgMQ8S8+AqBIl6kKgHiXqQqAeJepBo/z38J/U0uAHlaBkBl9I4GwAAAABJRU5ErkJggg==');*left:0}.pika-next,.is-rtl .pika-prev{float:right;background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAAU0lEQVR42u3VOwoAMAgE0dwfAnNjU26bYkBCFGwfiL9VVWoO+BJ4Gf3gtsEKKoFBNTCoCAYVwaAiGNQGMUHMkjGbgjk2mIONuXo0nC8XnCf1JXgArVIZAQh5TKYAAAAASUVORK5CYII=');*right:0}.pika-prev.is-disabled,.pika-next.is-disabled{cursor:default;opacity:.2}.pika-select{display:inline-block;*display:inline}.pika-table{width:100%;border-collapse:collapse;border-spacing:0;border:0}.pika-table th,.pika-table td{width:14.285714285714286%;padding:0}.pika-table th{color:#999;font-size:12px;line-height:25px;font-weight:bold;text-align:center}.pika-button{cursor:pointer;display:block;box-sizing:border-box;-moz-box-sizing:border-box;outline:0;border:0;margin:0;width:100%;padding:5px;color:#666;font-size:12px;line-height:15px;text-align:right;background:#f5f5f5}.pika-week{font-size:11px;color:#999}.is-today .pika-button{color:#3af;font-weight:bold}.is-selected .pika-button,.has-event .pika-button{color:#fff;font-weight:bold;background:#3af;box-shadow:inset 0 1px 3px #178fe5;border-radius:3px}.has-event .pika-button{background:#005da9;box-shadow:inset 0 1px 3px #0076c9}.is-disabled .pika-button,.is-inrange .pika-button{background:#d5e9f7}.is-startrange .pika-button{color:#fff;background:#6cb31d;box-shadow:none;border-radius:3px}.is-endrange .pika-button{color:#fff;background:#3af;box-shadow:none;border-radius:3px}.is-disabled .pika-button{pointer-events:none;cursor:default;color:#999;opacity:.3}.is-outside-current-month .pika-button{color:#999;opacity:.3}.is-selection-disabled{pointer-events:none;cursor:default}.pika-button:hover,.pika-row.pick-whole-week:hover .pika-button{color:#fff;background:#ff8000;box-shadow:none;border-radius:3px}.pika-table abbr{border-bottom:0;cursor:help}.pika-time-container{clear:both}.pika-time{margin:7px auto 7px}.pika-time .pika-time-label{font-weight:bold;font-size:11px;color:#666;padding-right:.33em}"
        },
        "$:/plugins/kixam/datepicker/readme": {
            "title": "$:/plugins/kixam/datepicker/readme",
            "text": "! ~DatePicker\n\nA plugin for [[TiddlyWiki|http://tiddlywiki.com]] 5, that provides [[Pikaday|https://github.com/dbushell/Pikaday]].\n"
        },
        "$:/plugins/kixam/datepicker/usage": {
            "title": "$:/plugins/kixam/datepicker/usage",
            "text": "`<$edit-date>`\n\nThis plugin can pick days and times.\n\n!! attributes\nAll attributes are optional.\n\n|!Attribute|!Purpose|!Default value|\n|`tiddler`|Edited tiddler|//current tiddler//|\n|`field`|Edited field|`created`|\n|`format`|Date format as it is shown in input control, in [[moment.js|http://momentjs.com]]'s [[parse+string format|http://momentjs.com/docs/#/parsing/string-format/]]|`YYYY-MM-DD`|\n|`firstDay`|First day of the week (0: Sunday, 1: Monday, etc.)|`0`|\n|`fieldFormat`|Date format used to save into the field, in [[moment.js|http://momentjs.com]]'s [[parse+string format|http://momentjs.com/docs/#/parsing/string-format/]]|`YYYYMMDDHHmmssSSS`|\n|`placeholder`|Placeholder|//empty//|\n|`tag`|HTML tag to render the editor|`input`|\n|`index`|The index to edit|//empty//|\n|`class`|A CSS class to be assigned to the generated HTML editing element|\n|`attributes`|[[JSON Tiddler|http://tiddlywiki.com/#JSONTiddlers]] containing HTML attributes attached to the HTML object used to render the editor, typically `style`|//empty//|\n|`icon`|Image tiddler or URL to an image that will be rendered next to the `tag`. When clicked, it will trigger the date picker|//empty//|\n|`showTime`|Show time as well as date|//not set//|\n|`showSeconds`|If `showTime` is set, shows seconds as well|//not set//|\n|`use24hour`|If `showTime` is set, use 24-hour format|//not set//|\n"
        },
        "$:/plugins/kixam/datepicker/widget.datepicker.js": {
            "title": "$:/plugins/kixam/datepicker/widget.datepicker.js",
            "text": "/*\\\ntitle: $:/plugins/kixam/datepicker/widget.datepicker.js\ntype: application/javascript\nmodule-type: widget\n\n  A widget for displaying date pickers using Pikaday at https://github.com/owenmead/Pikaday\n\n  For full help see $:/plugins/kixam/datepicker/usage\n\n  TODO: use HTML5 \"date\" (and not \"datetime-local\") input types if available\n  TODO: set field type/flag to \"date\" to make TW5 render {{!!ourField}} as expected, i.e. like it renders e.g. {{!!created}}\n  TODO: use our widget for system date fields (created, modified, ...)\n\\*/\n\n/*jslint node: true, browser: true */\n/*global $tw: false */\n\n(function() {\n  'use strict';\n\n  var Widget = require(\"$:/core/modules/widgets/widget.js\").widget;\n  var moment = require(\"$:/plugins/kixam/moment/moment.js\");\n  var pikaday = require(\"$:/plugins/kixam/datepicker/pikaday.js\"); // this is a modified version of pikaday.js, see build.sh\n  var image = require(\"$:/core/modules/widgets/image.js\").image;\n\n  var DatePickerWidget = function(parseTreeNode, options) {\n    Widget.call(this);\n    this.initialise(parseTreeNode, options);\n    this.options = options;\n  };\n\n  DatePickerWidget.prototype = new Widget();\n\n  DatePickerWidget.prototype.render = function(parent,nextSibling) {\n    this.computeAttributes();\n    this.renderChildren(parent,nextSibling);\n    this.execute();\n    this.parentDomNode = parent;\n\n    // set HTML tag\n    if(!this.editTag || $tw.config.htmlUnsafeElements.indexOf(this.editTag) !== -1) {\n      this.editTag = \"input\";\n    }\n\n    // set HTML item attributes\n    if(this.editAttributesTiddlerName) {\n      this.editAttributes = $tw.wiki.getTiddlerData(this.editAttributesTiddlerName, {});\n    }\n\n    // create HTML item\n    this.editor = $tw.utils.domMaker(this.editTag, {attributes: this.editAttributes});\n\n    if(this.editPlaceholder) {\n      this.editor.setAttribute(\"placeholder\",this.editPlaceholder);\n    }\n\n    if(this.editClass) {\n      this.editor.setAttribute(\"class\",this.editClass);\n    }\n\n    // render HTML item\n    parent.insertBefore(this.editor, nextSibling);\n    this.domNodes.push(this.editor);\n\n    // render icon\n    if(this.iconPath) {\n      var tiddler = this.wiki.getTiddler(this.iconPath);\n      if(tiddler && tiddler.hasTag(\"$:/tags/Image\")) {\n        // this is a system icon tiddler: just transclude the tiddler\n        this.icon = $tw.utils.domMaker(\"span\", {innerHTML: tiddler.fields.text});\n        parent.insertBefore(this.icon, this.editor);\n        this.domNodes.push(this.icon);\n      } else {\n        // this is something else: render it using <$image> widget\n        var ptn = this.parseTreeNode;\n        ptn.attributes = {source: {name: \"source\", type: \"string\", value: this.iconPath} };\n        this.icon = new image(ptn, this.options);\n        this.icon.render(this.parentDomNode, this.editor);\n      }\n    }\n\n    this.onPickerDateSelect = this.onPickerDateSelect.bind(this);\n\n    var langprefix = \"$:/languages/\".length,\n        lang = $tw.wiki.getTiddlerText(\"$:/language\").substring(langprefix, langprefix + 2);\n    if(lang === \"zh\") {\n      // TW5 does not use standard codes for Chinese\n      var suffix = $tw.wiki.getTiddlerText(\"$:/language\");\n      suffix = suffix.substring(suffix.length-1);\n      if(suffix === \"s\") {\n        lang = \"zh-cn\"; //simplified\n      } else {\n        lang = \"zh-tw\"; //traditional\n      }\n    }\n\n    var locale = moment.localeData(moment.locale([lang, \"en\"])),\n        i18n = {\n          previousMonth : \"Previous Month\",\n          nextMonth     : \"Next Month\",\n          months        : locale._months,\n          monthsShort   : locale._monthsShort,\n          weekdays      : locale._weekdays,\n          weekdaysShort : locale._weekdaysShort,\n        };\n\n    this.picker = new pikaday({\n      field: this.editor,\n      trigger: this.icon || this.editor,\n      format: this.editFormat,\n      firstDay: this.firstDay,\n      onSelect: this.onPickerDateSelect,\n      showTime: this.showTime,\n      showSeconds: this.showSeconds,\n      use24hour: this.use24hour,\n      i18n: i18n,\n    });\n\n    this.refreshSelf();\n  };\n\n  DatePickerWidget.prototype.execute = function() {\n    // Get our parameters\n    this.showTime = this.getAttribute(\"showTime\");\n    this.showSeconds = this.getAttribute(\"showSeconds\");\n    this.use24hour = this.getAttribute(\"use24hour\");\n\n    var defaultFormat = \"YYYY-MM-DD\";\n    if(this.showTime) {\n      if(this.use24hour) defaultFormat += \" HH\";\n      else defaultFormat += \" hh\";\n      defaultFormat += \":mm\";\n      if(this.showSeconds) defaultFormat += \":ss\";\n    }\n    this.editFormat = this.getAttribute(\"format\", defaultFormat);\n    this.firstDay = parseInt(this.getAttribute(\"firstDay\", \"0\"));\n    this.saveFormat = this.getAttribute(\"fieldFormat\", \"YYYYMMDDHHmmssSSS\");\n    this.editTitle = this.getAttribute(\"tiddler\", this.getVariable(\"currentTiddler\"));\n    this.editField = this.getAttribute(\"field\",\"created\");\n    this.editIndex = this.getAttribute(\"index\");\n    this.editClass = this.getAttribute(\"class\");\n    this.editPlaceholder = this.getAttribute(\"placeholder\");\n    this.editTag = this.getAttribute(\"tag\");\n    this.editAttributesTiddlerName = this.getAttribute(\"attributes\");\n    this.iconPath = this.getAttribute(\"icon\");\n  };\n\n  // Selectively refreshes the widget if needed. Returns true if the widget or any of its children needed re-rendering\n  DatePickerWidget.prototype.refresh = function(changedTiddlers) {\n    var changedAttributes = this.computeAttributes();\n    // Refresh if an attribute has changed, or the type associated with the target tiddler has changed\n    if(changedAttributes.tiddler || changedAttributes.field || changedAttributes.index || changedTiddlers[this.editTitle]) {\n      this.refreshSelf();\n      return true;\n    } else {\n      return this.refreshChildren(changedTiddlers);\n    }\n  };\n\n  DatePickerWidget.prototype.refreshSelf = function() {\n    var val = moment.utc(this.getEditInfo().value, this.saveFormat);\n    if(val.isValid()) {\n      this.editor.value = val.format(this.editFormat);\n      this.picker.setMoment(val, true);\n    }\n  }\n\n  DatePickerWidget.prototype.onPickerDateSelect = function() {\n    var val = this.picker.getMoment();\n    if(this.showTime) val = val.utc();\n    this.saveChanges(val.format(this.saveFormat));\n    $tw.rootWidget.dispatchEvent({type: \"tm-auto-save-wiki\"});\n  };\n\n// ---------------------------------------------------------- //\n// --- inspired from $:/core/modules/widgets/edit-text.js --- //\n// ---------------------------------------------------------- //\n\n  DatePickerWidget.prototype.saveChanges = function(text) {\n    var editInfo = this.getEditInfo();\n    if(text !== editInfo.value) {\n        editInfo.update(text);\n    }\n  };\n\n  DatePickerWidget.prototype.getEditInfo = function() {\n    // Get the edit value\n    var self = this,\n        value,\n        update;\n    if(this.editIndex) {\n        value = this.wiki.extractTiddlerDataItem(this.editTitle,this.editIndex,this.editDefault);\n        update = function(value) {\n            var data = self.wiki.getTiddlerData(self.editTitle,{});\n            if(data[self.editIndex] !== value) {\n                data[self.editIndex] = value;\n                self.wiki.setTiddlerData(self.editTitle,data);\n            }\n        };\n    } else {\n        // Get the current tiddler and the field name\n        var tiddler = this.wiki.getTiddler(this.editTitle);\n        if(tiddler) {\n            // If we've got a tiddler, the value to display is the field string value\n            value = tiddler.getFieldString(this.editField);\n        } else {\n            // Otherwise, we need to construct a default value for the editor\n            switch(this.editField) {\n                case \"text\":\n                    value = \"Type the text for the tiddler '\" + this.editTitle + \"'\";\n                    break;\n                case \"title\":\n                    value = this.editTitle;\n                    break;\n                default:\n                    value = \"\";\n                    break;\n            }\n            if(this.editDefault !== undefined) {\n                value = this.editDefault;\n            }\n        }\n        update = function(value) {\n            var tiddler = self.wiki.getTiddler(self.editTitle),\n                updateFields = {\n                    title: self.editTitle\n                };\n            updateFields[self.editField] = value;\n            self.wiki.addTiddler(new $tw.Tiddler(self.wiki.getCreationFields(),tiddler,updateFields,self.wiki.getModificationFields()));\n        };\n    }\n    return {value: value, update: update};\n  };\n\n// ---------------------------------------------------------- //\n// ---------------------------------------------------------- //\n// ---------------------------------------------------------- //\n\n  exports[\"edit-date\"] = DatePickerWidget;\n}\n());\n",
            "type": "application/javascript",
            "module-type": "widget"
        }
    }
}